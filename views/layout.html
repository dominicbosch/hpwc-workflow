<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>HPWC Workflow - {% block title %}{% endblock %}</title>
	<script type="text/javascript" src="../js/jquery-1.11.2.min.js"></script>
	<link rel="stylesheet" href="../css/layout.css">
	{% if user %}
	<script type="text/javascript">
	
		"use strict";

		$(document).ready(function() {

			//Get the possible configuration and check for the current configuration reading the project
			$.get('/services/gen/getConfigs', function( data ) {

				//put data inside "configs" element
				var i = 1;
				data.forEach(function(config) {
					$('#configs').append($('<option>').attr('value', config).text('Configuration' + i));
					i = i + 1;
				});

				
				{% if connection %}

				//Current configuration not empty
				var currentConf = "{{ connection.name}}";

				//set current configuration, change event is not raised because the configuration details are read from the session
				$("#configs").val(currentConf);

				//retrieve project list if old connection is set
				$.get('/services/project/getProjects', function( data ) {

					var projects_string = '<option value="">Choose A Project</option>';
					data.forEach(function(project) {
						projects_string += '<option value="' + project + '">' + project + '</option>';
					});

					$('#projects').html(projects_string);

					{% if connection.project %}

					//Current project not empty
					var currentProject = "{{ connection.project.name }}";
					
					//set current project, change event is not raised because the project details are read from the session
					$("#projects").val(currentProject);

					{% block method %}{% endblock %}

					{% else %}

					//Current project empty

					{% endif %}
				});

				{% else %}

				//Current configuration empty

				{% endif %}
			});
		});		
	</script>
	{% endif %}
	{% block head %}{% endblock %}

</head>
<body>
	<header>
		<a href="/views/index"><img src="../img/unilogo_HPWC_small.png"></a>
		<div></div>
	</header>
	<nav>
		<a href="/views/project">Project</a>
		<a href="/views/method">Method</a>
		<a href="/views/experiment">Experiment</a>
		<a href="/views/visualization">Visualization</a>
		{% if user %}
			<a href="/views/logout">Logout</a>
		{% else %}
			<a href="/views/login">Login</a>
			<a href="/views/register">Register</a>
		{% endif %}
	</nav>
	<section>
		<div class="left">{% block content_left %}{% endblock %}</div>
		<div class="right">
		{% if user %}
		{% block shared_content_right %}
			<table>
				<tr>
					<td>
						<div id="preview">
							<div id="conf_title">
								<label for="configs">Current connection settings</label>
								<select id="configs" name="configs">
									<option value="">Choose A Configuration</option>
								</select>
							</div>
							<table id="conf_table">
								<tr>
									<th>
										Hostname
									</th>
									<td name="hostname">
										{% if connection %}
											{{ connection.hostname }}
										{% else %}
											--
										{% endif %}
									</td>
								</tr>
								<tr>
									<th>
										Url
									</th>
									<td name="host">
										{% if connection %}
											{{ connection.url }}
										{% else %}
											--
										{% endif %}
									</td>
								</tr>
								<tr>
									<th>
										Username
									</th>
									<td name="username">
										{% if connection %}
											{{ connection.username }}
										{% else %}
											--
										{% endif %}
									</td>
								</tr>
								<tr>
									<th>
										Workflow path
									</th>
									<td name="workflow">
										{% if connection %}
											{{ connection.workhome }}
										{% else %}
											--
										{% endif %}
									</td>
								</tr>
								<tr>
									<th>
										Workspace path
									</th>
									<td name="workspace">
										{% if connection %}
											{{ connection.workspace }}
										{% else %}
											--
										{% endif %}
									</td>
								</tr>
							</table>
						</div>
					</td>
				</tr>
			</table>
		{% endblock %}
		{% endif %}
		{% block content_right %}{% endblock %}
		</div>
	</section>
	<footer>
	</footer>
</body>
</html>